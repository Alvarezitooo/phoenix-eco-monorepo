# Phoenix Ecosystem - Configuration Render Production
# Architecture Monorepo avec Web Services + Background Workers + APIs

services:
  # WEB SERVICES (Applications utilisateurs)
  
  # Service 1: Phoenix Letters - Generateur de lettres IA
  - type: web
    name: phoenix-letters
    env: docker
    dockerfilePath: ./Dockerfile
    dockerBuildArgs:
      - APP_NAME=phoenix-letters
    plan: starter
    envVars:
      # Variables critiques (a configurer dans Render Dashboard)
      - key: GOOGLE_API_KEY
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: STRIPE_SECRET_KEY
        sync: false
      - key: STRIPE_PUBLISHABLE_KEY
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
    healthCheckPath: "/_stcore/health"

  # Service 2: Phoenix CV - Generateur CV IA  
  - type: web
    name: phoenix-cv
    env: docker
    dockerfilePath: ./Dockerfile
    dockerBuildArgs:
      - APP_NAME=phoenix-cv
    plan: starter
    envVars:
      # Variables critiques
      - key: GOOGLE_API_KEY
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: STRIPE_CV_PRICE_ID
        sync: false
    healthCheckPath: "/_stcore/health"

  # Service 3: Phoenix Backend Unifie - API centrale
  - type: web
    name: phoenix-backend-unified
    env: docker
    dockerfilePath: ./Dockerfile
    dockerBuildArgs:
      - APP_NAME=phoenix-backend-unified
    plan: starter
    envVars:
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: JWT_SECRET_KEY
        sync: false
      - key: ALLOWED_ORIGINS
        value: "https://phoenix-aube.vercel.app,https://phoenix-rise.vercel.app"
      - key: ENVIRONMENT
        value: "production"
    healthCheckPath: "/health"

# Simplification pour déploiement initial - 3 services essentiels
# Les autres services peuvent être ajoutés progressivement

